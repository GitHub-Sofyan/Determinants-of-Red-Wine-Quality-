---
title: "Exploratory Data Analysis on the Factors of Red Wine Quality using R"
author: Sofyan Sahrom
output: 
  html_document:
    toc: true
    toc_depth: 3
    toc_float: true
---

# Research Question: Which chemical properties influence the quality of red wines?

Background: Red Wine quality is graded by experts on a scale of 0 (very bad) to 10 (very excellent). To help understand what are the factors that determine the wine quality, the physicochemical properties of the wine was investigated. This is a qualititave measurement.

By examining the physicochemical properties of wines of different grades, it might be possible to investigate whether there are factors or variables that can help determine the quality of red wine. This can help to quantify some of the grading process of the what is eitherwise a very qualitative measurement. This information in turn can be used in the future to help create a preliminary grading of wine quality (based on quantifiable measures) or something smiliar alomg that line. An example is a predictive model (based on the variables) that will be able to provide guidance to vineyard to determine their quality (and price) quantifiable without the wine tasters that might be more volatile.

Therefore the quality of wine will be the dependent variable while the physicochemical properties of the wine will be the independent variables or factors.

# Sources:
Data Set is taken from [here](https://s3.amazonaws.com/udacity-hosted-downloads/ud651/wineQualityReds.csv):

Udacity DAND Project requirement: Complete Univariate -> Bivariate -> Multivariate Plot

# Preparation for EDA - Loading of all relevant dependancies and libaries (that will be required for the EDA)

```{r echo=FALSE, message=FALSE, warning=FALSE}
library(ggplot2)
library(dplyr)
library(e1071)  
library(gridExtra)
library(Simpsons)
library(GGally)
library(memisc)
library(pander)
library(corrplot)
library(outliers)
```

# Loading and Reconnaisance of Data (Part I)
```{r echo=FALSE, message=FALSE, warning=FALSE}
wine <- read.csv('C:/Users/sofya_000/Python Notebooks/Udacity Nanodegree/Data Analyst/Project - Exploratory Data Analysis/wineQualityReds.csv')[-1] # Loading the csv file
head(wine) # Reconnaisance of Data - Preview of dataframe
str(wine) # Struture and Details of the Data
summary(wine) # General Descriptive Statistics of the Data
```

```{r echo=FALSE, message=FALSE, warning=FALSE}
invisible(transform(wine, quality = as.numeric(quality))) # Change quality from int to dbl. It is the only column that is not a dbl. This was added post-hoc due to several ploting errors below. Therefore added this her to minimise errors later.
```

# Understanding the Data:

Reconnaisannce of the DataFrame revealed that 11 physicochemical properties were recorded. This will be the independent variables of interest or factors that may have an effect on the quality of wine.


```{r echo=FALSE, message=FALSE, warning=FALSE}
# Creating String for later analysis - Kurtosis and Skewness
skew = "Skewness: "
kurt = "Kurtosis: "
d.corr = "Correlation :"
```
               
# Surveying the Battlefield I (Quality of Wine - Dependent Variable): 
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine, aes(x = quality)) + 
  geom_bar(width = 1, color = 'white', fill = 'red') +
  geom_vline(xintercept = median(as.numeric(wine$quality)), color = "black") +
  labs(x = "Quality of wine", 
       y = "Number of simples", 
       title = "Distribution of wine Quality")
w.quality <- wine$quality
s.quality <- skewness(w.quality)
k.quality <- kurtosis(w.quality)
sprintf("%s %s", skew, s.quality)
sprintf("%s %s", kurt, k.quality)
summary(w.quality)
```

1) Distribution: Kurtosis Based on the distribution of the wine quality, it seems that majority of the red wines in the samples have been graded at 5 and 6, each with at least 600 counts. While this means that we are likely able to assess which physicochemical properties that make up wines at theses grades (5 and 6) and do so confidently, we might not be able to do the same with the other grades and perhaps more importantly compares across grades. In fact, the wines of other grades, may actually appear like outliers rather than the norm. That means we can conclude that wine of quality 5 or 6 may have a certain set of physichemical properties (with confidence), we might not be so confident (statistically) in determining if a higher level or lower level is better.

2) Sample Population As mentioned, the main wines are of grades 5 and 6. It is possible that this sampling could not have been done properly or biased.

# Surveying the Battlefield II (Independent Variables): 

Now that we have looked at the distribution of the dependent Variables.We can now compare it to the distribution of the independent variables to give an indication of their possible contribution (or not). This will be done through boxplots. 

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}
attach(wine)
par(mfrow=c(2,6), oma = c(1,1,0,0) + 0.1,  mar = c(3,3,1,1) + 0.1)
boxplot(fixed.acidity, col="slategray2", pch=19)
mtext("Fixed Acidity", cex=0.8, side=1, line=2)
boxplot(volatile.acidity, col="slategray2", pch=19)
mtext("Volatile Acidity", cex=0.8, side=1, line=2)
boxplot(citric.acid, col="slategray2", pch=19)
mtext("Citric Acid", cex=0.8, side=1, line=2)
boxplot(residual.sugar, col="slategray2", pch=19)
mtext("Residual Sugar", cex=0.8, side=1, line=2)
boxplot(chlorides, col="slategray2", pch=19)
mtext("Chlorides", cex=0.8, side=1, line=2)
boxplot(free.sulfur.dioxide, col="slategray2", pch=19)
mtext("Free Sulfur Dioxide", cex=0.8, side=1, line=2)
boxplot(total.sulfur.dioxide, col="slategray2", pch=19)
mtext("Total Sulfur Dioxide", cex=0.8, side=1, line=2)
boxplot(density, col="slategray2", pch=19)
mtext("Density", cex=0.8, side=1, line=2)
boxplot(pH, col="slategray2", pch=19)
mtext("pH Level", cex=0.8, side=1, line=2)
boxplot(sulphates, col="slategray2", pch=19)
mtext("Sulphates", cex=0.8, side=1, line=2)
boxplot(alcohol, col="slategray2", pch=19)
mtext("Alcohol", cex=0.8, side=1, line=2)
```

From this boxplots of the 11 variables, we can see some variables that are not likely to play a huge role in determining the quality of wine. These variables are Residual Sugar and Chlories. Citric Acid, Free Sulphur Dioxide and Alcohol Seems to possible stronger contributors to wine quality. However his is purely based on distribution and not correlation.  

# Reconnaisance of Data (Part II) - Correlation of variables

From the earlier reconnaisance of Data, it seems that there are 11 independent variables that could possible have an influence on the quality of the red wine. Therefore we will need to narrow down the variables, so we can determine the order (based on the correlation) of the 11 variables that we will be investigating. This will done by doing principal component analysis (PCA) plot.

```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=9, fig.height=7}
biplot(prcomp(wine, scale.=T), xlabs=rep(".", nrow(wine)))
```

From the PCA, we can see that alcohol content is the closest in correlation (positive) to quality, followed by sulphate and citric acid. There also possible negative correlation for some variables. We can then plot the univariates and make the subsequent analysis based on this order (strength of correlation) as a guide. These observations from the PCA is similiar to what was observed during the boxplot. At this stage, we can start to narrow down to alcohols as are variable that is worth a deeper look. 

# Univariate Plots Section

Normally, to answer a question, such as the current question: Which chemical properties influence the quality of red wines?. We will start with a Multivariate plot to see the various relationships and help filter and guide to which variables, we should be paying attention to. But for this project, it is required to be done the other way. From Univariate to Multivariate. Therefore we will now commence with univariate plotting and analysis. Based on pervious plots we will begin with Alcohol. 

Outliers. All 11 variables are likely to have outliers (as observed from the reconnaisance of the data above), these outliers may be dropped during the plotting to allow a bigger and more general representation of the distribution of the data. Since the univariate plotting at this stage is meant for general EDA, this will be acceptable. Therefore all univariate plots shown below are likely to have some outliers be dropped. These outliers may (or may not) be included back for the actual analysis to answer the research question. 

# Univariate Plots - Alcohol
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = alcohol)) +
  geom_histogram(binwidth = 1, color = 'black',fill = I('yellow')) + 
  scale_x_continuous(lim = c(5,15)),
ggplot(data = wine, aes(x = factor(quality), y = alcohol)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.alcohol <- wine$alcohol
s.alcohol <- skewness(w.alcohol)
k.alcohol <- kurtosis(w.alcohol)
c.alcohol <- cor (w.alcohol, w.quality)
sprintf("%s %s", skew, s.alcohol)
sprintf("%s %s", kurt, k.alcohol)
sprintf("%s %s", d.corr, c.alcohol)
summary(w.alcohol)
```

Univariate Plots - Alcohol: From the histogram, as expected alcohol content showed a relatively similiar distribution to quality. From the boxplot, with the exception of wine quality 5, it can be observed that better wines have a higher alcohol content. However, as mentioend earlier, there is very little data on the tail ends. Thus this observation may not be accurate. 


# Univariate Plots - Sulphates
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = sulphates)) +
  geom_histogram(binwidth = 0.1, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(0,1.5)),
ggplot(data = wine, aes(x = factor(quality), y = sulphates)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.sulphates <- wine$sulphates
s.sulphates <- skewness(w.sulphates)
k.sulphates <- kurtosis(w.sulphates)
c.sulphates <- cor (w.sulphates, w.quality)
sprintf("%s %s", skew, s.sulphates)
sprintf("%s %s", kurt, k.sulphates)
sprintf("%s %s", d.corr, c.sulphates)
summary(w.sulphates)
```

Univariate Plots - Sulphates: From the histogram, as expected sulphates content showed a relatively similiar distribution to quality. From the boxplot, it can be observed that better wines have a higher sulphate content. However, as mentioend earlier, there is very little data on the tail ends. Thus this observation may not be accurate. 

# Univariate Plots - Total Sulfur Dioxiode
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = total.sulfur.dioxide)) +
  geom_histogram(binwidth = 10, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(0,180)),
ggplot(data = wine, aes(x = factor(quality), y = total.sulfur.dioxide)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.tsd <- wine$total.sulfur.dioxide
s.tsd <- skewness(w.tsd)
k.tsd <- kurtosis(w.tsd)
c.tsd <- cor (w.tsd, w.quality)
sprintf("%s %s", skew, s.tsd)
sprintf("%s %s", kurt, k.tsd)
sprintf("%s %s", d.corr, c.tsd)
summary(w.tsd)
```

Univariate Plots - Total Sulfur Dioxiode: From the boxplot, it seems that average wine quality seems to have a higher Total sulfer dioxide, while poorer and higher quality have lower levels. The lack of a negative tail could suggest that there is a minimum level of total sulfur dioxide for a liquid the called wine. 

# Univariate Plots - Free Sulfur Dioxiode
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = free.sulfur.dioxide)) +
  geom_histogram(binwidth = 1, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(0,50)),
ggplot(data = wine, aes(x = factor(quality), y = free.sulfur.dioxide)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.fsd <- wine$free.sulfur.dioxide
s.fsd <- skewness(w.fsd)
k.fsd <- kurtosis(w.fsd)
sprintf("%s %s", skew, s.fsd)
sprintf("%s %s", kurt, k.fsd)
summary(w.fsd)
```

Univariate Plots - Free Sulfur Dioxiode: Free Sulfur Dioxide shows a negative skew. This could suggest that the majority of wine quality 5 and 6 are in that skewed region. However the high count on the positive tail suggest this might not be the case. The lack of a negative tail could suggest that there is a minimum level of free sulfur dioxide for a liquid the called wine. 

# Univariate Plots - Density
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = density)) +
  geom_histogram(binwidth = 0.001, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(0.99,1.005)),
ggplot(data = wine, aes(x = factor(quality), y = density)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.density <- wine$density
s.density <- skewness(w.density)
k.density <- kurtosis(w.density)
c.density <- cor (w.density, w.quality)
sprintf("%s %s", skew, s.density)
sprintf("%s %s", kurt, k.density)
sprintf("%s %s", d.corr, c.density)
summary(w.density)
```

Univariate Plots - Density: Density shows a relative normal distribution. This could suggest that the majority of wine quality 5 and 6 are in that region. This is confirmed by the boxplot which also suggest that better wines are less dense. 

# Univariate Plots - Acidity - Volatile Acidity
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = volatile.acidity)) +
  geom_histogram(binwidth = 0.1, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(0.10,1.6)),
ggplot(data = wine, aes(x = factor(quality), y = volatile.acidity)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.va <- wine$volatile.acidity
s.va <- skewness(w.va)
k.va <- kurtosis(w.va)
c.va <- cor (w.va, w.quality)
sprintf("%s %s", skew, s.va)
sprintf("%s %s", kurt, k.va)
sprintf("%s %s", d.corr, c.va)
summary(w.va)
```

Univariate Plots - Volatile Acidity: Volatile Acidity shows a somehwat normal distribution. This could suggest that the majority of wine quality 5 and 6 are in that region. From the boxplot, it is observed that better wines have lower volatile acidity. 

# Univariate Plots - Acidity - Fixed Acidity
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = fixed.acidity)) +
  geom_histogram(binwidth = 1, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(4,16)),
ggplot(data = wine, aes(x = factor(quality), y = fixed.acidity)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.fa <- wine$fixed.acidity
s.fa <- skewness(w.va)
k.fa <- kurtosis(w.fa)
c.fa <- cor (w.fa, w.quality)
sprintf("%s %s", skew, s.fa)
sprintf("%s %s", kurt, k.fa)
sprintf("%s %s", d.corr, c.fa)
summary(w.fa)
```

### Univariate Plots - Fixed Acidity: While the histogram shows a relatively normal distribution (with a slight negative skew). The boxplot suggest that there is no difference in fixed acidity levels among the various wine quality. 

# Univariate Plots - Acidity - pH
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = pH)) +
  geom_histogram(binwidth = 0.1, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(2.500,4.000)),
ggplot(data = wine, aes(x = factor(quality), y = pH)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.pH <- wine$pH
s.pH <- skewness(w.pH)
k.pH <- kurtosis(w.pH)
c.pH <- cor (w.pH, w.quality)
sprintf("%s %s", skew, s.pH)
sprintf("%s %s", kurt, k.pH)
sprintf("%s %s", d.corr, c.pH)
summary(w.pH)
```

Univariate Plots - pH: While the histogram shows a relatively normal distribution (with a slight negative skew). The boxplot suggest that there better wines have a slightly lower levels of pH. However this difference is insignificant. 

# Univariate Plots - Residual Sugar
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = residual.sugar)) +
  geom_histogram(binwidth = 0.1, color = 'black',fill = I('light blue')) + 
  scale_x_continuous(lim = c(2,8)),
ggplot(data = wine, aes(x = factor(quality), y = residual.sugar)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.rs <- wine$residual.sugar
s.rs <- skewness(w.rs)
k.rs <- kurtosis(w.rs)
c.rs <- cor (w.rs, w.quality)
sprintf("%s %s", skew, s.rs)
sprintf("%s %s", kurt, k.rs)
sprintf("%s %s", d.corr, c.rs)
summary(w.rs)
```

Univariate Plots - Residual Sugar: Residual Sugar shows a significant negative skew. This could suggest that the majority of wine quality 5 and 6 are in that skewed region. However the high count on the positive tail suggest this might not be the case. The lack of a negative tail could suggest that there is a minimum level of Residual Sugar for a liquid the called wine. From the boxplot it can be seen that there is no significant difference between the levels of residual sugar in the wines. 

# Univariate Plots - Citric Acid
```{r echo=FALSE, message=FALSE, warning=FALSE}
grid.arrange(ggplot(data = wine, aes(x = citric.acid)) +
  geom_histogram(binwidth = 0.1, color = 'black',fill = I('orange')) + 
  scale_x_continuous(lim = c(0,0.8)),
ggplot(data = wine, aes(x = factor(quality), y = citric.acid)) +
  geom_jitter( alpha = .3) +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4),ncol = 2)
w.ca <- wine$citric.acid
s.ca <- skewness(w.ca)
k.ca <- kurtosis(w.ca)
c.ca <- cor (w.ca, w.quality)
sprintf("%s %s", skew, s.ca)
sprintf("%s %s", kurt, k.ca)
sprintf("%s %s", d.corr, c.ca)
summary(w.ca)
```

Univariate Plots - Citric Acid: This was a slightly surprising plot. Considering how citric acid was observed to possibly have a correlation, its distribution was expected to show something similair, but as seen from the histogram it is not. The Boxplot however shows that better wines have higher levels of citric acid. Nevertheless this is worth further investigation. 

# Univariate Analysis

What is the structure of your dataset?

This data set has 12 columns (12x variables, not inclusive index), with 1599 rows (records). 11 of the columns are numerical - float (dbl). Surprisingly Quality which is from 0 to 10 is an integer (still numerical) but not necessarily float. It was transformed into a numerical (dbl). Quality is used as the main anchor/variable for description for the distribution which has been shown to have high kurtosis and very slight skewness. Data on both tail ends are very limited, which might make analsysis inaccurate. 

What is/are the main feature(s) of interest in your dataset?

The main anchor variable is the Quality. It is the dependent variable and the main component of the research question. 


What other features in the dataset do you think will help support your \ investigation into your feature(s) of interest?

Did you create any new variables from existing variables in the dataset?

No, new variables was created. It was initially though that creating a new variable rating (poor, average and good) based on wine quality would be beneficial. However considering that the kurtosis of the data and that they were only 5 grades of quality, doing so might lead to a loss of information, especially on the tail ends and between 5 and 6 (both due to the kurtosis).

Of the features you investigated, were there any unusual distributions? \ Did you perform any operations on the data to tidy, adjust, or change the form \ of the data? If so, why did you do this?

Normally outliers would be investigated and removed (especially if they are due to measurement error etc). However for this project, no outliers were removed from the data set. These outliers were ignored when ploting. This is to allow for a more robust, bigger and "typical" (of the data) distribution (for univariate plots).


# Bivariate Plots Section

As highlighted in the univariate plots above, they are some variables that are worth further investigation, due to its distribution in relation to its correlation. Therefore the next step is to look at 2 variables in relation to quality. 

Finding correlation between 2 variables - Both Graphical and Numerical. The plot below, will show the correlation between 2 variables and provide a circle and a numerical value. The size of the circle will show the strength of correlation. Simultaneously the color of the circle and numbers will also indicate the strength of correlation.

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Finding correlation between 2 variables (Graphical Detail)
wine_cor <- as.matrix(wine)
# Plotting correlation graph
corrplot(cor(wine_cor), method = c("circle")) # Graphical
corrplot(cor(wine_cor), method = c("number")) # Numbers
# Finding correlation between 2 variables (Numeric Detail)
bc <- cor(
  wine %>%
    mutate(quality = as.numeric(quality)) # mutate quality (to numeric) to fix           check_caption for pandoc.table
) # close
pandoc.table(bc, style = 'simple') # present correlation (bc) as a simple table.
```

From the correlation table (bc) and the correlation plot, the strongest correlation (positive) to alcohol as seen earlier in the PCA is alcohol (0.4762), this is followed by sulphates (0.2514). This would mean that higher concentrations off these variables in the wine, would mean that it is a higher quality wine. However there are other correlations (negative) with quality, this would be Volatile Acidity. Which means the lesser the volatile acidity in the wine, the higher the quality of wine.

Alcohol is observed to have negative correlation with Density (-0.4962), which is logical, considering that density of water and alcohol (water is denser than alcohol).

Density seems to be affected by the levels/ amount of Residual Sugar and Citirc Acid. Residual sugar seems to have low levels of correlations with most other variables (other than density), which suggest that density is an inherent characteristic of the wine itself and have a effect on the density of the wine itself but not necessarily the quality (0.01373), which means the wine tasters might not be looking at the "sweetness" levels of the wine.

Citric Acid is observed to have a strong correlation with Fixed Acidity (0.6717), which is logical from an acidity point of view. This also suggest that the wine's fixed acidity is affected by the citric acidity levels. Citric Acidity levels will likely have an influence on the "taste (citrius)" of the wine, which could also possibly reflect the wine tasters preferance (correlation = 0.2264) 

Citric Acid in turn is observed to be correlated with Sulphates (0.3128). 

# Bivariate Analysis

Better Quality wine is observed to have higher levels of Citric Acid and lower levels of Fixed Acidity. However the correlation is lesser than with citric acid. 

# Observations
Residual Sugar and Fixed Acidity seems to have almost NO effect on quality.

Better Wine (quality) is observed to have a higher levels of Citric Acid, Acidity and possibly Alcohol (which in turn is possible related to some other factors such as density). 

Better Wine (quality) is observed to have a lower level of Chloride, less dense (possibly related to alcohol) and lower levels of Volatile Acidity. 

Other indirect: Volatile acidity and pH seems to have a postive correlation due to Simpson's paradox.


# Multivariate Plots Section

From the bivariate plot (table) we can see that there are some variables that are likley to be a strong factor or determinant of wine quality. We will now use some of these variables as constant and compare it, with another variable and quality. 

The plots below will consists of three variables and the strength or their correlation. The constant will be on the x-axis, while the other variable will be on the y axis. The shade of color will determine the correlation with wine quality. Thus we will be able to see these 2 variables in relation to quality. 

# Alcohol As Constant (vs. Density vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
wine$quality <- as.factor(wine$quality) # Turn quality into a factor                               (as opposed to continuous scale)
ggplot(data = wine,
       aes(y = density, x = alcohol,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  + 
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.density <- cor (w.density, w.alcohol)
sprintf("%s %s", d.corr, c2.density)
```

Surprisingly density does not seem to play a prominent role on the wine quality. This suggest that the Density correlation observed earlier was due to Alcohol levels

# Alcohol As Constant (vs. Sulphates vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = sulphates, x = alcohol,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.sulphates <- cor (w.sulphates, w.alcohol)
sprintf("%s %s", d.corr, c.sulphates)
```

Very weak correlation (by the flat and spread out data). At most it can be suggested (weakly) that better wines that has has a higher alcohol content also have a higher level of sulphates.

# Alcohol As Constant (vs. Volatile Acidity vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = volatile.acidity, x = alcohol,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.va <- cor (w.va, w.alcohol)
sprintf("%s %s", d.corr, c.va)
```

As expected and confirmed, better wines have less concentration of volatile acid and higher level of alcohol. 

# Alcohol As Constant (vs. pH vs. Quality)

```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = pH, x = alcohol,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.pH <- cor (w.pH, w.alcohol)
sprintf("%s %s", d.corr, c.pH)
```

As observed in this plot, better wines are more acidic (low pH) and higher in Alcohol. 

# Alcohol As Constant (vs. residual.sugar vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = residual.sugar, x = alcohol,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.rs <- cor (w.rs, w.alcohol)
sprintf("%s %s", d.corr, c.rs)
```

As expected, not much relationship observed between residual sugar and quality. 

# Alcohol As Constant (vs. Total Sulfur Dioxide vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = total.sulfur.dioxide, x = alcohol,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.tsd <- cor (w.tsd, w.alcohol)
sprintf("%s %s", d.corr, c2.tsd)
```

It is observed that better wines has lower levels of sulphur dioxide. Significant outliers exist. 

Since Volaile Acidity has shown to have a high negative correlation, it will now be the constant. 

# Volatile.Acidity As Constant (vs. Citric Acid vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = citric.acid, x = volatile.acidity,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.ca <- cor (w.ca, w.va)
sprintf("%s %s", d.corr, c2.ca)
```

Better Quality wine is observed to have higher levels of Citric Acid and lower levels of volatile acidity.

# Volatile.Acidity As Constant (vs. Fixed Acidity vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = fixed.acidity, x = volatile.acidity,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.fa <- cor (w.fa, w.va)
sprintf("%s %s", d.corr, c2.fa)
```

Similiar to Citric Acid, better Quality wine is observed to have higher levels of Fixed Acidity and lower levels of volatile acidity. However the correlation is slightly lesser than with citric acid for lower quality wines. 

# Citric Acid As Constant (vs. Fixed Acidity vs. Quality)
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine,
       aes(y = fixed.acidity, x = citric.acid,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality'))
c2.fa <- cor (w.fa, w.ca)
sprintf("%s %s", d.corr, c2.fa)
```

# Linear Modelling

Based on the analysis above, 6 variables which are most strongly correlated with the quality of the wine are selected to create a linear model. 

# Linear Modelling based on up to 6 variables
```{r echo=FALSE, message=FALSE, warning=FALSE}
focused_data <- sample_frac(wine, .6)
m1 <- lm(as.numeric(quality) ~ alcohol, data = focused_data)
m2 <- update(m1, ~ . + sulphates)
m3 <- update(m2, ~ . + volatile.acidity)
m4 <- update(m3, ~ . + citric.acid)
m5 <- update(m4, ~ . + fixed.acidity)
m6 <- update(m5, ~ . + density)
m7 <- update(m2, ~ . + pH)
m8 <- update(m3, ~ . + fixed.acidity + density + pH)
mtable(m1,m2,m3,m4,m5,m6,m7,m8)
```

# Testing the Accuracy of the Model: Comparison

```{r echo=FALSE, message=FALSE, warning=FALSE}
# Testing the Accuracy of our model
acc_model <- predict(m5, newdata = wine,interval = "prediction", level = 0.95)
predicted.quality <- round(as.data.frame(acc_model)$fit,0)
sum(predicted.quality == wine$quality)/nrow(wine)
```

# Testing the Accuracy of the Model: m3 - Using a sample set of variables (3 samples).
```{r echo=FALSE, message=FALSE, warning=FALSE}
trialwine = data.frame(alcohol= 15, sulphates= 0.45, volatile.acidity = 0.4)
modelEstimate.example = predict(m3, newdata = trialwine, 
        interval="prediction", level = .95)
predicted.quality.trial <- round(as.data.frame(modelEstimate.example)$fit,0)
answer <- as.numeric(predicted.quality.trial)
print(answer)
```

Based on the 3 variables, the model gave an average score of 5 which is generic and about right

# Testing the Accuracy of the Model: m6 - Using a sample set of variables (Sample Wine No. 8)
```{r echo=FALSE, message=FALSE, warning=FALSE}
trialwine8 = data.frame(alcohol= 10, sulphates= 0.47, volatile.acidity = 0.5, 
        citric.acid = 0.00, fixed.acidity = 7.3, density = 0.99460)
modelEstimate.example = predict(m6, newdata = trialwine8, 
        interval="prediction", level = .95)
predicted.quality.trial <- round(as.data.frame(modelEstimate.example)$fit,0)
answer <- as.numeric(predicted.quality.trial)
print(answer)
```

Using the model m6, we tried predicting the wine quality of a sample wine number 8 and inputing its characteristics into the model. Unfortunately instead of getting an 7, the model gave a 4. This means the model is invalid. 

# Testing the Accuracy of the Model: m8 - Using a sample set of variables (Sample Wine No. 8)
```{r echo=FALSE, message=FALSE, warning=FALSE}
trialwine8 = data.frame(alcohol= 10, sulphates= 0.47, volatile.acidity = 0.5, 
          fixed.acidity = 7.3, density = 0.99460, pH = 3.39)
modelEstimate.example = predict(m8, newdata = trialwine8, 
          interval="prediction", level = .95)
predicted.quality.trial <- round(as.data.frame(modelEstimate.example)$fit,0)
answer <- as.numeric(predicted.quality.trial)
print(answer)
```

Using the model m8, we tried predicting the wine quality of a sample wine number 8 and inputing its characteristics into the model. Unfortunately instead of getting an 7, the model gave a 3. This means the model is invalid. 

So far only model m3 seems to be the most accurate. 


# Multivariate Analysis

Talk about some of the relationships you observed in this part of the assessment.
Better Wine have 1) higher alcohol levels, 2) Sulaphate content and 3) lower levels of volatile acidity. 

Were there any interesting or surprising interactions between features?
Citric Acid, seems to contribute to wine quality, however the correlation while distinct is weak. It is perhaps a condounding factor or might not even be an important factor.

OPTIONAL: Did you create any models with your dataset? Discuss the strengths and limitations of your model.

Several (7) simple linear models were created based on 3, 4, 5, 6 variables and different combinations. However most of these linear models prove to be inaccurate, when tested and gave results that are in the middle (4 and 5). It is likely that the low confidence level (due to lack of data on the the tail ends) could be one of the main reasons. Another reason is that it is likely that the relationship between the variables and quality may not necessarily be linear and thus the failure of a linear model to predict them. It was also observed that alcohol while likely to be a condtibutor, it may not be the stongest contributor (0.219) with a low value (R squared), or they could be a limited range for its contributions. 

------

# Final Plots and Summary

As mentioned alcohol and sulphates play a determing factor in alcohol quality. It is also observed that other variables possibly play a part or interaction. The following 3 plots have been selected to show the journey taken to answer the research question. 





# Plot 1 - Distribution of Variables 
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data = wine, aes(x = quality)) + 
  geom_bar(width = 1, color = 'white', fill = 'red') +
  geom_vline(xintercept = median(as.numeric(wine$quality)), color = "black") +
  labs(x = "Quality of wine", 
       y = "Count of samples", 
       title = "Final Plot 1 - Distribution of Wine Quality")

summary(wine$quality)
```

This figure explains that most (82.5 %) of the sample wines in this dataset  of wines in dataset are of quality 5 & 6 (also the median). Very little on the tail end, which as mentioned might allow us to understand what makes wine of quality 5 and 6, nut not any other, and without others to compare to, it would be hard to determine or check.

# Plot 2 - Influence of Alcohol on Quality of Wine
```{r echo=FALSE, message=FALSE, warning=FALSE}
ggplot(data=wine, aes(y=alcohol, x=factor(quality))) + 
  geom_jitter(alpha = .3)  +
  geom_boxplot(alpha = .5,color = 'blue') +
  stat_summary(fun.y = "mean", 
               geom = "point", 
               color = "red", 
               shape = 8, 
               size = 4) +
  xlab("Quality (0 - 10)") +
  ylab("Alcohol Percentage (%)") +
  ggtitle(
"Final Plot 2 - Influence of Alcohol percentage (% by volume) on the Quality of Wine")
```

This plot which has been explored earlier, shows the clear influence of alcohol on wine quality, however as observed in later plots and modelling, it is not the only determinant. At the same time, it shows the lack of data on the tail ends of the dataset (3, 4, 7 & 8). Therefore this plot place is justified here as it shows that perhaps a better prediction model or information could have been obtained with a better data set. Nevertheless we can conclude alcohol's role on wine quality. 

# Plot 3 - Influence of Volatile Acidity and Alcohol on Wine Quality.
```{r echo=FALSE, message=FALSE, warning=FALSE, fig.width=8, fig.height=6}
plot <- ggplot(data = wine,
       aes(y = volatile.acidity, x = alcohol,
           color = quality)) +
  geom_point(alpha = 0.8, size = 1) +
  geom_smooth(method = "lm", se = FALSE,size=1)  +
  theme_dark() +
  scale_color_brewer(type='seq',
                   guide=guide_legend(title='Quality(0-10)'))
plot + 
ggtitle("Final Plot 3 - Influence of Volatile Acidity + Alcohol on Wine Quality")
```

This final plot shows that better wines have less concentration of volatile acid and higher level of alcohol.

------

# Reflection

Challenges and Issues: This is a challenging project and data set for me for several reasons which can be divided into 2 main categories 1) Data Set, 2) Personal.

1) Data Set: 
First, outliers or rather the lack of removing/treatment it. Usually one of the very first steps would be to investigate outliers, as the outliers could be possibly due to several other reasons such as measurement error etc. 

Second, the high kurtosis, while has its advantages also suggest a poor sampling OR a poor reliability of the wine tasters. This in turn brought about several challenges. An example of a issue is the difficulty in getting higher confidence level when trying to answer the research question (variables that affect wine quality). The high kurtosis severly limited the ability to build a model as not enough data on either tail ends was availiable.

Third, Qualitative Assessment of the wine tasters. This is perhaps one of the biggest issue I have with the data. The inter and intra reliability of the wine tasters were not provided. This was one of the most significant deficiency of the data sets and could be one of the possible reasons for the issues mentioned above. Wine tasters being humans are known to have variability. This would mean that the wine quality rating might not be reliable in the first place. Considering that the wine quality is THE dependent variable that we are bsing the research question, more rigor and reliability standards is expected. A simple ICC among the raters would have been significantly helpful. For example, in anthropometry, an ISAK certified technican is required to provide their error or measurement (which is dependent on their level and experience), they are then required to "recalibrate" every three years. Considering that wine tasting is very qualitative compared to anthropometry (body measurement, thus quantifiable data), this was a significant problem.

Personal: 
First, the reverse method required for this project is also unusual. Usually when I am conducting research of several variables(5 or more), I try to see the big picture first (multivariate) and explore from that perspective, then from there I will then narrow down or focus on possible interactions (univariate) and (bivariate). Nevertheless I see the value of this method. 

Second, I have never used R before, and while I admit the plots in R seems to be graphically and aesthtically nicer (as compared to Python), it is more tedious to understand. However there was some issues (at least with the way I am using it) with R packages, which I cannot solve directly "Error in cor(wine) : 'x' must be numeric"," even until now (even checking on stack overflow) and I had to resort to indirect solutions. Perhaps it could be the way R was installed in my desktop(which is what strongly suspect). Nevertheless it is a good learning event and challenge for me and I appreciate learning a new language.

Another error I had with error is the inability to determine the variable. For example, I was under the assumption that once I have done this wine$quality <- as.factor(wine$quality) # Turn quality into a factor (as opposed to continuous scale). It will stay the same for subsequent analysis. But it did not. 

Third, I have never consumed wine or any alcoholic/intoxicating beverages. Therefore while I am familiar with all of the terms, which is very basic/primary school level chemistry, I am unfamiliar with what makes a good wine. For example, should wine be acidity/citrius tasting or should it be light (less dense). Therefore this was a very difficult exercise for me, as I had not background to guide me. Not sure why anyone would want to consume something that will intoxicate or impair their judgement, but the multi-billion dollar wine industry suggest that there are alot of people who would want to intoxicate (and impair their actions) themselves. As this is something new to me, I appreciate the new learning opportunity (if I ever work with wine industry in future) and the challenge. 

In Summary, the main issue lies with the one variable that is made by humans (which are falliable, and cannot be trusted to the same level as machines and robots, especially since the wine itself could possible have impaired the judgement of the wine tasters). All other variables are more reliable. This could have been mitigated by providing intra- and inter- reliability measuresments and by highlighting the process/methods that the wine was graded (this would make it reproducible and add the minimum rigor required for the data to be trusted). This in combination with a normal (distribution) data set might allow for a better data analysis. 


# General Observation

Citric Acid. It appeared that Citirc Acid could have an influence on wine qualitY, perhaps indirectly through the taste. However, some wines seems to be lacking in this variable completly, as a non-alcoholic consumer, I could not understand this and had to investigate. I appeared that citirc acid is sometimes added to increase the acidity. Which does makes sense, similairy to how some candy manufacturer adds "Vitamin C (absorbic acid)" to as a perservative but the consumers believes that it is for health purposes. 

# References
Wilson JH, Joye SW. Research Methods and Statistics - An Integrated Approach. Thousand Oaks, California: SAGE Publications, Inc; 2017. 

Godden, P.W. Update on the AWRI trial of the technical performance of various types of wine bottle closure. Tech. Rev. 139: 6-10; 2002. (Technical Review #139).

Wikipedia - [About Wine](https://en.wikipedia.org/wiki/Wine)

Wikipedia - [Classification of Wine](https://en.wikipedia.org/wiki/Classification_of_wine)

Wikipedia - [Acids in Wine](https://en.wikipedia.org/wiki/Acids_in_wine)

[R Manuals](https://cran.r-project.org/manuals.html)

Chang, Winston, R Graphics Cookbook, 2013.

R Stats Package - [Principal Component Analysis](https://stat.ethz.ch/R-manual/R-devel/library/stats/html/prcomp.html)

# End of Project

